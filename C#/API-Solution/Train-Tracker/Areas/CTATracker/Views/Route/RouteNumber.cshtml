@model List<Train_Tracker.Models.TrainModel>
@using Microsoft.AspNetCore.Mvc.ModelBinding
@{
    string route = (ViewBag.SelectedRoute as string) ?? (string?)Context.Request.Query["route"] ?? "red";
    string runNumber = (ViewBag.RouteNumber as string) ?? (string?)Context.Request.Query["rn"] ?? "000";
    
    string displayRoute = Functions.GetDisplayName(route);
    string lineCss = Functions.GetLineCss(route);
    string buttonCss = Functions.GetButtonCss(route);

    ViewData["Title"] = $"{displayRoute} Line Route Number: {@runNumber} - CTA Tracker";
}

<div class="container text-center">
    <h2 class="@lineCss">@displayRoute Line</h2>
    
    <h5 class="@lineCss">Route Number: @runNumber</h5>
    
    <form asp-controller="Route" asp-action="RouteNumber" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" name="rn" value="@runNumber" />
        <input type="hidden" name="route" value="@route" />
        <button type="submit" class="btn @buttonCss">Fetch Route Number: @runNumber Data</button>
    </form>
    
    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger mt-3">
            @foreach (ModelError err in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <div>@err.ErrorMessage</div>
            }
        </div>
    }
    
    @if (Model is { Count: > 0 })
    {
        <div class="mt-3">
            <h5 class="@lineCss">Train Stops</h5>
            <table class="table table-striped table-bordered table-hover" style="width: 100%">
                <thead>
                    <tr>
                        <th>Station Name</th>
                        <th>Station Description</th>
                        <th>Final Destination</th>
                        <th>Estimated Arrival Time</th>
                        <th>Is Approaching?</th>
                        <th>Is Delayed?</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (TrainModel train in Model)
                    {
                        <tr>
                            <td>@train.StationName</td>
                            <td>@train.StationDescription</td>
                            <td>@train.DestinationName</td>
                            <td>@train.EstimatedArrival</td>
                            <td>@(string.Equals(train.Approaching, "1", StringComparison.Ordinal) ? "True" : "False")</td>
                            <td>@(string.Equals(train.Delayed, "1", StringComparison.Ordinal) ? "True" : "False")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>