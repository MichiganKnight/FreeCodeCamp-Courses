@model List<Train_Tracker.Areas.CTATracker.Models.RouteModel>
@using Microsoft.AspNetCore.Mvc.ModelBinding
@using Train_Tracker.Areas.CTATracker.Models
@{
    string? route = ViewBag.SelectedRoute as string;

    string displayRoute = Functions.GetDisplayName(route);
    string lineCss = Functions.GetLineCss(route);
    string buttonCss = Functions.GetButtonCss(route);
    
    ViewData["Title"] = $"{displayRoute} Line - CTA Tracker";
}

<div class="container text-center">
    <h2 class="@lineCss">@displayRoute Line</h2>

    <form asp-area="CTATracker" asp-controller="Line" asp-action="TrainLine" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" name="route" value="@route" />
        <button type="submit" class="btn @buttonCss">Fetch @displayRoute Line Data</button>
    </form>

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger mt-3">
            @foreach (ModelError err in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <div>@err.ErrorMessage</div>
            }
        </div>
    }
    
    @if (Model is { Count: > 0})
    {
        <div class="mt-3">
            <h5 class="@lineCss">Active @displayRoute Line Trains</h5>
            <table class="table table-striped table-bordered table-hover" style="width:100%">
                <thead>
                    <tr>
                        <th>Route Number</th>
                        <th>Destination</th>
                        <th>Next Station</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (RouteModel train in Model)
                    {
                        <tr>
                            <td>
                                <a asp-area="CTATracker" asp-controller="Route" asp-action="RouteNumber" asp-route-rn="@train.RouteNumber" asp-route-route="@route" class="text-decoration-none @lineCss">@train.RouteNumber</a>
                            </td>
                            <td>@train.Destination</td>
                            <td>@train.NextStationName</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else if (ViewBag.Requested == true)
    {
        <div class="mt-3 alert-danger">No Trains Found</div>
    }
</div>