@model List<CTA_Tracker.Models.TrainItem>
@using Microsoft.AspNetCore.Mvc.ModelBinding
@{
    string? route = ViewBag.SelectedRoute as string;
    string routeKey = (route ?? string.Empty).ToLowerInvariant();

    Dictionary<string, (string Display, string Css)> lineMap = new()
    {
        ["red"] = ("Red", "redLine"),
        ["blue"] = ("Blue", "blueLine"),
        ["brn"] = ("Brown", "brownLine"),
        ["g"] = ("Green", "greenLine"),
        ["org"] = ("Orange", "orangeLine"),
        ["pink"] = ("Pink", "pinkLine"),
        ["p"] = ("Purple", "purpleLine"),
        ["y"] = ("Yellow", "yellowLine")
    };

    Dictionary<string, (string Display, string Css)> buttonMap = new()
    {
        ["red"] = ("Red", "btn-red-line"),
        ["blue"] = ("Blue", "btn-blue-line"),
        ["brn"] = ("Brown", "btn-brown-line"),
        ["g"] = ("Green", "btn-green-line"),
        ["org"] = ("Orange", "btn-orange-line"),
        ["pink"] = ("Pink", "btn-pink-line"),
        ["p"] = ("Purple", "btn-purple-line"),
        ["y"] = ("Yellow", "btn-yellow-line")
    };

    (string, string) info = lineMap.TryGetValue(routeKey, out (string Display, string Css) x) ? x : ("Selected", "redLine");
    (string, string) button = buttonMap.TryGetValue(routeKey, out (string Display, string Css) y) ? y : ("Selected", "btn-red-line");
    
    string displayRoute = info.Item1;
    string lineCss = info.Item2;

    string buttonCss = button.Item2;
    
    ViewData["Title"] = $"{displayRoute} Line";
}

<div class="container text-center">
    <h2 class="@lineCss">@displayRoute Line</h2>

    <form asp-controller="Line" asp-action="TrainLine" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" name="route" value="@route" />
        <button type="submit" class="btn @buttonCss">Fetch @displayRoute Line Data</button>
    </form>

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger mt-3">
            @foreach (ModelError err in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <div>@err.ErrorMessage</div>
            }
        </div>
    }
    
    @if (Model is { Count: > 0})
    {
        <div class="mt-3">
            <h5 class="@lineCss">Active @displayRoute Line Trains</h5>
            <table class="table table-striped table-bordered table-hover" style="width:100%">
                <thead>
                    <tr>
                        <th>Route Number</th>
                        <th>Destination</th>
                        <th>Next Station</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (TrainItem train in Model)
                    {
                        <tr>
                            <td>
                                <a asp-area="" asp-controller="Route" asp-action="RouteNumber" asp-route-rn="@train.RouteNumber" asp-route-route="@route" class="text-decoration-none @lineCss">@train.RouteNumber</a>
                            </td>
                            <td>@train.Destination</td>
                            <td>@train.NextStationName</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else if (ViewBag.Requested == true)
    {
        <div class="mt-3 alert-danger">No Trains Found</div>
    }
</div>