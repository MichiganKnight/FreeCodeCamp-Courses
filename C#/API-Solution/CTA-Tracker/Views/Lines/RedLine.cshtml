@model List<CTA_Tracker.Models.TrainItem>
@using Microsoft.AspNetCore.Mvc.ModelBinding
@{
    ViewData["Title"] = "Red Line";
}

<div class="container text-center">
    <h2 class="redLine">Red Line</h2>

    <form asp-controller="Lines" asp-action="RedLine" method="post">
        @Html.AntiForgeryToken()
        <button type="submit" class="btn btn-red-line">Fetch Red Line Data</button>
    </form>

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger mt-3">
            @foreach (ModelError err in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <div>@err.ErrorMessage</div>
            }
        </div>
    }
    
    @if (Model is { Count: > 0})
    {
        <div class="mt-3">
            <h5 class="redLine">Active Red Line Trains</h5>
            <table class="table table-striped table-bordered table-hover" style="width:100%">
                <thead>
                    <tr>
                        <th>Route Number</th>
                        <th>Destination</th>
                        <th>Next Station</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (TrainItem train in Model)
                    {
                        <tr>
                            <td>
                                <a asp-area="" asp-controller="Route" asp-action="RouteNumber" asp-route-rn="@train.RouteNumber" class="text-decoration-none redLine">@train.RouteNumber</a>
                            </td>
                            <td>@train.Destination</td>
                            <td>@train.NextStationName</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else if (ViewBag.Requested == true)
    {
        <div class="mt-3 alert-danger">No Trains Found</div>
    }

    <!--@if (ViewBag.Json is string json && !string.IsNullOrWhiteSpace(json))
    {
        <pre class="mt-3 text-start">@json</pre>
    }-->
</div>